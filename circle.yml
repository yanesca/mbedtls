test:
    override:
        - cd ../mbed-tls-sample && mbed compile -m K64F -t GCC_ARM -c -j0

dependencies:
    pre:
        - pwd
        # Install gcc-arm
        #- cd .. && wget "https://launchpad.net/gcc-arm-embedded/4.9/4.9-2015-q3-update/+download/gcc-arm-none-eabi-4_9-2015q3-20150921-linux.tar.bz2"
        #- cd .. && tar -xvjf gcc-arm-none-eabi-4_9-2015q3-20150921-linux.tar.bz2
        #- cd .. && ls
        #- ln -s ../gcc-arm-none-eabi-4_9-2015q3/bin/* ../bin/
        #- ls ../bin/
        # Install gcc-arm
        - sudo add-apt-repository -y ppa:terry.guo/gcc-arm-embedded
        - sudo apt-get -y update
        - sudo apt-get -y install gcc-arm-none-eabi=4.9.3.2015q3-1precise1
        # Install mbed-cli
        - cd ../ && git clone https://github.com/ARMmbed/mbed-cli.git
        - cd ../mbed-cli && sudo -H pip install -e .
        # Get the sample application
        - cd ../ && git clone git@github.com:ARMmbed/mbed-tls-sample.git
        # Get mbed-os
        - cd ../mbed-tls-sample/ && rm mbed-os.lib
        - cd ../mbed-tls-sample/ && mbed add https://github.com/ARMmbed/mbed-os
        - cd ../mbed-tls-sample/ && mbed update
        # Import mbedtls current revision
        - ls ../mbed-tls-sample/
        - ls ../mbed-tls-sample/mbed-os/
        - ls ../mbed-tls-sample/mbed-os/features/
        - ls ../mbed-tls-sample/mbed-os/features/mbedtls/
        - ls ../mbed-tls-sample/mbed-os/features/mbedtls/importer/
        - ls ../mbed-tls-sample/mbed-os/features/mbedtls/importer/TARGET_IGNORE/
        - ln -s ../../../../../../mbedtls/ ../mbed-tls-sample/mbed-os/features/mbedtls/importer/TARGET_IGNORE/mbedtls
        - cd ../mbed-tls-sample/mbed-os/features/mbedtls/importer/ && make
    override:
        # Install the missing python packages
        - cd ../mbed-tls-sample/mbed-os && sudo -H pip install -r requirements.txt
